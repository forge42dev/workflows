#!/usr/bin/env bash
__dirname="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"

GITHUB_REPOSITORY="${GITHUB_REPOSITORY:-a-org-42/monorepo}"
GITHUB_EVENT_NAME="${GITHUB_EVENT_NAME:-pull_request}"
GITHUB_REF_NAME="${GITHUB_REF_NAME:-feature/foo-bar}"
GITHUB_REF_TYPE="${GITHUB_REF_TYPE:-branch}"
GITHUB_SHA="${GITHUB_SHA:-abcde42eee4d0b74fcae7adf4b00a08c9cd9e122}"
GITHUB_EVENT_PATH="${GITHUB_EVENT_PATH:-"${__dirname}/events/${GITHUB_EVENT_NAME}.json"}"

workflow_inputs=$(cat "$__dirname/inputs.json")
workflow_secrets=$(cat "$__dirname/secrets.json")
workflow_event=$(cat "$GITHUB_EVENT_PATH" | jq -rS '{number, pull_request_head_sha: .pull_request.head.sha}')

source "$__dirname/../scripts/fly_deploy.sh"

